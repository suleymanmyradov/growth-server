syntax = "proto3";

package notifications;

option go_package = "./notifications";

message Notification {
  string id = 1;
  string user_id = 2;
  string type = 3; // habit_reminder, goal_deadline, achievement, system
  string title = 4;
  string message = 5;
  bool read = 6;
  string created_at = 7;
  string read_at = 8;
  map<string, string> metadata = 9;
  string action_url = 10; // optional deep link
}

message ListNotificationsRequest {
  string user_id = 1;
  bool unread_only = 2;
  string type = 3; // optional filter
  int32 limit = 4;
  int32 offset = 5;
}

message ListNotificationsResponse {
  repeated Notification notifications = 1;
  int32 total = 2;
  int32 unread_count = 3;
}

message MarkNotificationReadRequest {
  string id = 1;
  string user_id = 2;
}

message MarkNotificationReadResponse {
  Notification notification = 1;
}

message MarkAllNotificationsReadRequest {
  string user_id = 1;
}

message MarkAllNotificationsReadResponse {
  int32 marked_count = 1;
}

message GetNotificationRequest {
  string id = 1;
  string user_id = 2;
}

message GetNotificationResponse {
  Notification notification = 1;
}

message DeleteNotificationRequest {
  string id = 1;
  string user_id = 2;
}

message DeleteNotificationResponse {
}

message CreateNotificationRequest {
  string user_id = 1;
  string type = 2;
  string title = 3;
  string message = 4;
  map<string, string> metadata = 5;
  string action_url = 6;
}

message CreateNotificationResponse {
  Notification notification = 1;
}

message GetNotificationPreferencesRequest {
  string user_id = 1;
}

message GetNotificationPreferencesResponse {
  NotificationPreferences preferences = 1;
}

message NotificationPreferences {
  string user_id = 1;
  bool email_enabled = 2;
  bool push_enabled = 3;
  bool habit_reminders = 4;
  bool goal_deadlines = 5;
  bool achievements = 6;
  bool system_updates = 7;
  string timezone = 8;
  map<string, bool> custom_preferences = 9;
}

message UpdateNotificationPreferencesRequest {
  string user_id = 1;
  bool email_enabled = 2;
  bool push_enabled = 3;
  bool habit_reminders = 4;
  bool goal_deadlines = 5;
  bool achievements = 6;
  bool system_updates = 7;
  string timezone = 8;
  map<string, bool> custom_preferences = 9;
}

message UpdateNotificationPreferencesResponse {
  NotificationPreferences preferences = 1;
}

message GetUnreadCountRequest {
  string user_id = 1;
}

message GetUnreadCountResponse {
  int32 count = 1;
}

message GetNotificationTypesRequest {
}

message GetNotificationTypesResponse {
  repeated NotificationType types = 1;
}

message NotificationType {
  string type = 1;
  string display_name = 2;
  string description = 3;
  bool default_enabled = 4;
}

service NotificationsService {
  // CRUD operations
  rpc ListNotifications(ListNotificationsRequest) returns (ListNotificationsResponse);
  rpc GetNotification(GetNotificationRequest) returns (GetNotificationResponse);
  rpc CreateNotification(CreateNotificationRequest) returns (CreateNotificationResponse);
  rpc DeleteNotification(DeleteNotificationRequest) returns (DeleteNotificationResponse);
  
  // Read status
  rpc MarkNotificationRead(MarkNotificationReadRequest) returns (MarkNotificationReadResponse);
  rpc MarkAllNotificationsRead(MarkAllNotificationsReadRequest) returns (MarkAllNotificationsReadResponse);
  rpc GetUnreadCount(GetUnreadCountRequest) returns (GetUnreadCountResponse);
  
  // Preferences
  rpc GetNotificationPreferences(GetNotificationPreferencesRequest) returns (GetNotificationPreferencesResponse);
  rpc UpdateNotificationPreferences(UpdateNotificationPreferencesRequest) returns (UpdateNotificationPreferencesResponse);
  rpc GetNotificationTypes(GetNotificationTypesRequest) returns (GetNotificationTypesResponse);
}
