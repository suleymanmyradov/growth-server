syntax = "proto3";

package report;

option go_package = "./report";

message Report {
  string id = 1;
  string user_id = 2; // optional
  string category = 3; // bug, abuse, content, feedback, other
  string subject = 4;
  string details = 5;
  string email = 6; // optional
  string status = 7; // pending, in_progress, resolved, closed
  string priority = 8; // low, medium, high, critical
  repeated string attachments = 9;
  string created_at = 10;
  string updated_at = 11;
  string resolved_at = 12;
  string resolution = 13;
}

message SubmitReportRequest {
  string user_id = 1; // optional
  string category = 2;
  string subject = 3;
  string details = 4;
  string email = 5; // optional
  repeated string attachments = 6;
}

message SubmitReportResponse {
  Report report = 1;
  string message = 2;
}

message GetReportRequest {
  string id = 1;
  string user_id = 2; // optional, for user access
}

message GetReportResponse {
  Report report = 1;
}

message ListReportsRequest {
  string user_id = 1; // optional, for user's reports
  string category = 2; // optional filter
  string status = 3; // optional filter
  string priority = 4; // optional filter
  int32 limit = 5;
  int32 offset = 6;
}

message ListReportsResponse {
  repeated Report reports = 1;
  int32 total = 2;
}

message UpdateReportRequest {
  string id = 1;
  string user_id = 2; // optional
  string status = 3;
  string priority = 4;
  string resolution = 5;
}

message UpdateReportResponse {
  Report report = 1;
}

message GetReportCategoriesRequest {
}

message ReportCategory {
  string name = 1;
  string display_name = 2;
  string description = 3;
}

message GetReportCategoriesResponse {
  repeated ReportCategory categories = 1;
}

message UploadAttachmentRequest {
  string report_id = 1;
  string user_id = 2; // optional
  bytes file_data = 3;
  string filename = 4;
  string content_type = 5;
}

message UploadAttachmentResponse {
  string attachment_url = 1;
  repeated string attachments = 2;
}

message GetReportStatusRequest {
  string id = 1;
  string user_id = 2; // optional
}

message GetReportStatusResponse {
  string status = 1;
  string updated_at = 2;
  string estimated_resolution = 3;
}

message AddReportCommentRequest {
  string report_id = 1;
  string user_id = 2; // optional
  string comment = 3;
  bool is_internal = 4; // admin only
}

message ReportComment {
  string id = 1;
  string report_id = 2;
  string user_id = 3; // optional
  string comment = 4;
  bool is_internal = 5;
  string created_at = 6;
}

message AddReportCommentResponse {
  ReportComment comment = 1;
}

message GetReportCommentsRequest {
  string report_id = 1;
  string user_id = 2; // optional
  bool include_internal = 3; // admin only
}

message GetReportCommentsResponse {
  repeated ReportComment comments = 1;
}

message CloseReportRequest {
  string id = 1;
  string user_id = 2; // optional
  string resolution = 3;
}

message CloseReportResponse {
  Report report = 1;
}

service ReportService {
  // Report CRUD
  rpc SubmitReport(SubmitReportRequest) returns (SubmitReportResponse);
  rpc GetReport(GetReportRequest) returns (GetReportResponse);
  rpc ListReports(ListReportsRequest) returns (ListReportsResponse);
  rpc UpdateReport(UpdateReportRequest) returns (UpdateReportResponse);
  rpc CloseReport(CloseReportRequest) returns (CloseReportResponse);
  
  // Report metadata
  rpc GetReportCategories(GetReportCategoriesRequest) returns (GetReportCategoriesResponse);
  rpc GetReportStatus(GetReportStatusRequest) returns (GetReportStatusResponse);
  
  // Attachments
  rpc UploadAttachment(UploadAttachmentRequest) returns (UploadAttachmentResponse);
  
  // Comments
  rpc AddReportComment(AddReportCommentRequest) returns (AddReportCommentResponse);
  rpc GetReportComments(GetReportCommentsRequest) returns (GetReportCommentsResponse);
}
